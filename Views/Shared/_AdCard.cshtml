@model BnsBazarApp.Models.Advertisement

<div class="card ad-card shadow-sm h-100 position-relative">

    @if (User.IsInRole("Admin"))
    {
        <form asp-controller="Advertisement"
              asp-action="Delete"
              method="post"
              class="ad-delete position-absolute top-0 end-0 m-2"
              onsubmit="return confirm('Are you sure you want to delete this advertisement?');">

            @Html.AntiForgeryToken()
            <input type="hidden" name="id" value="@Model.Id" />

            <button type="submit" class="btn btn-danger btn-sm">
                🗑
            </button>
        </form>
    }

    <div id="carousel-ad-@Model.Id" class="carousel slide" data-bs-ride="carousel">
        <div class="carousel-inner">
            @{
                bool active = false;
                void Img(string? u)
                {
                    if (!string.IsNullOrEmpty(u))
                    {
                        <div class="carousel-item @(active ? "" : "active")">
                            <img src="@u" class="d-block w-100 ad-media" />
                        </div>
                        ;
                        active = true;
                    }
                }
                Img(Model.Image1Url);
                Img(Model.Image2Url);
                Img(Model.Image3Url);
                Img(Model.Image4Url);
                Img(Model.Image5Url);

                if (!string.IsNullOrEmpty(Model.VideoUrl))
                {
                    <div class="carousel-item @(active ? "" : "active")">
                        <video class="d-block w-100 ad-media" controls>
                            <source src="@Model.VideoUrl" type="video/mp4" />
                        </video>
                    </div>
                    ;
                }
            }
        </div>

        @if (!string.IsNullOrEmpty(Model.Image2Url) ||
                !string.IsNullOrEmpty(Model.Image3Url) ||
                !string.IsNullOrEmpty(Model.Image4Url) ||
                !string.IsNullOrEmpty(Model.Image5Url) ||
                !string.IsNullOrEmpty(Model.VideoUrl))
        {
            <button class="carousel-control-prev" type="button"
                    data-bs-target="#carousel-ad-@Model.Id" data-bs-slide="prev">
                <span class="carousel-control-prev-icon"></span>
            </button>
            <button class="carousel-control-next" type="button"
                    data-bs-target="#carousel-ad-@Model.Id" data-bs-slide="next">
                <span class="carousel-control-next-icon"></span>
            </button>
        }
    </div>

    <div class="card-body d-flex flex-column">
        <span class="badge bg-secondary mb-2">@Model.Category</span>

        <h5 class="card-title mt-2 fw-bold">@Model.Title</h5>

        <p class="text-muted mb-1">📍 @Model.Location</p>

        <p class="mb-1">💰 मूल्य: <strong>रु. @Model.Price.ToString("N0")</strong></p>

        <p class="card-text small flex-grow-1">@Model.Description</p>

        <div class="mt-3 d-flex flex-wrap gap-2">
            @if (!string.IsNullOrEmpty(Model.Phone))
            {
                var phone = Model.Phone.StartsWith("+") ? Model.Phone : "+977" + Model.Phone;

                <a class="btn btn-success btn-sm" href="tel:@phone">📞 Call</a>
                <a class="btn btn-success btn-sm" target="_blank" href="https://wa.me/@phone">💬 WhatsApp</a>
            }

            @if (!string.IsNullOrEmpty(Model.Email))
            {
                <a class="btn btn-primary btn-sm" href="mailto:@Model.Email">📧 Email</a>
            }
        </div>
    </div>
</div>

<style>
    /* keep media consistent */
    .ad-media {
        height: 240px;
        object-fit: cover;
    }

    /* delete button always on top */
    .ad-delete {
        z-index: 9999;
    }

    /* if any container clips it */
    .ad-card {
        overflow: visible;
    }
</style>