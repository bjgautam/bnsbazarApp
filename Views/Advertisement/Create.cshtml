@model BnsBazarApp.Models.Advertisement

@{
    ViewData["Title"] = "विज्ञापन दर्ता";
}

<h2 class="mt-3 ad-heading">📝 नयाँ विज्ञापन दर्ता गर्नुहोस्</h2>

<form asp-action="Create" method="post" enctype="multipart/form-data">
    <div asp-validation-summary="All" class="text-danger mb-3"></div>

    <!-- CATEGORY -->
    <div class="form-group mt-3">
        <label>विज्ञापन प्रकार</label>
        <select asp-for="Category" class="form-control" id="categorySelect">
            <option value="">-- छान्नुहोस् --</option>
            <option value="House">घर (House)</option>
            <option value="Land">जग्गा (Land)</option>
            <option value="Car">कार (Car)</option>
            <option value="Bike">बाइक (Bike)</option>
            <option value="Electrical">Electrical</option>
            <option value="Electronics">Electronics</option>
            <option value="Computer">Computer</option>
            <option value="Laptop">Laptop</option>
            <option value="Mobile">Mobile</option>
            <option value="Other">अन्य सामान</option>
        </select>
        <span asp-validation-for="Category" class="text-danger"></span>
    </div>

    <!-- TITLE -->
    <div class="form-group mt-3">
        <label>शीर्षक</label>
        <input asp-for="Title" class="form-control" />
        <span asp-validation-for="Title" class="text-danger"></span>
    </div>

    <!-- LOCATION -->
    <div class="form-group mt-3">
        <label>स्थान</label>
        <input asp-for="Location" class="form-control" />
    </div>

    <!-- PRICE -->
    <div class="form-group mt-3">
        <label>मूल्य</label>
        <input asp-for="Price" type="number" step="0.01" class="form-control" />
        <span asp-validation-for="Price" class="text-danger"></span>
    </div>

    <!-- DESCRIPTION -->
    <div class="form-group mt-3">
        <label>विवरण</label>
        <textarea asp-for="Description" class="form-control"></textarea>
    </div>

    <!-- CONTACT -->
    <div class="form-group mt-3">
        <label>फोन नम्बर</label>
        <input asp-for="Phone" class="form-control" />
        <span asp-validation-for="Phone" class="text-danger"></span>
    </div>

    <div class="form-group mt-3">
        <label>इमेल</label>
        <input asp-for="Email" class="form-control" />
    </div>

    <div class="form-group mt-3">
        <label>एजेन्सी / कम्पनी</label>
        <input asp-for="Agency" class="form-control" />
    </div>

    <!-- IMAGES -->
    <div class="form-group mt-3">
        <label>फोटो (अधिकतम ५)</label>
        <input type="file" name="images" multiple class="form-control" accept="image/*" />
    </div>

    <!-- VIDEO (LIMIT 1 MIN) -->
    <div class="form-group mt-3">
        <label>भिडियो (१ मिनेटसम्म मात्र)</label>
        <input type="file"
               name="video"
               class="form-control"
              accept="video/mp4,video/quicktime"
               onchange="checkVideoDuration(this)" />
        <small class="text-muted">⚠️ 1 मिनेटभन्दा लामो भिडियो मान्य छैन</small>
    </div>

    <button type="submit" class="btn btn-primary mt-4">
        💾 सेभ गर्नुहोस्
    </button>
</form>
<script>
    function checkVideoDuration(input) {
        const file = input.files[0];
        if (!file) return;

        // Optional size safety (50MB)
        const maxSizeMB = 50;
        if (file.size > maxSizeMB * 1024 * 1024) {
            alert("❌ भिडियो धेरै ठूलो छ (५०MB भन्दा कम हुनुपर्छ)");
            input.value = "";
            return;
        }

        const video = document.createElement('video');
        video.preload = 'metadata';

        video.onloadedmetadata = function () {
            window.URL.revokeObjectURL(video.src);

            if (video.duration > 60) {
                alert("❌ भिडियो १ मिनेटभन्दा लामो छ। कृपया छोटो clip upload गर्नुहोस्।");
                input.value = "";
            }
        };

        video.src = URL.createObjectURL(file);
    }
</script>

}